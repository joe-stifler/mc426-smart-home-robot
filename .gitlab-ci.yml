stages:
  - build
  - test
  - flask api test

image: python:latest

services:
  - mongo

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"


cache:
  paths:
    - api-application/tests/*
    - .cache/pip
    - venv/


before_script:
  - python -V  # Print out python version for debugging
  - pip install virtualenv
  - virtualenv venv
  - source venv/bin/activate
  - pip install -r requirements.txt


build-code-job:
  stage: build
  script:
    - echo "Check the python version, then build some Python project files:"
    - apt-get -qq update && apt-get -qq install -y python
    - apt-get -qq update
    - apt-get -qq install -y python python-virtualenv python-pip


test-sensor:
  stage: test
  script:
    - echo "TESTING SOME SENSOR TESTS"
    - python -m unittest discover -s ./api-application/tests/sensor_controller/


test-security:
  stage: test
  script:
    - echo "TESTING SOME SECURITY TESTS"
    - python -m unittest discover -s ./api-application/tests/security_controller/

    
test-api:
  stage: flask api test
  script:
    - echo "RUNNING THE TEST API"
    - python api-application/routes.py &
    - python -m unittest discover -s ./api-application/tests/test_api.py